cluster_name: {{cluster_name}}

# The maximum number of workers nodes to launch in addition to the head node.
max_workers: {{num_nodes - 1}}
min_workers: {{num_nodes - 1}}
upscaling_speed: {{num_nodes - 1}}
idle_timeout_minutes: 60

provider:
  type: local
  head_ip: {{head_ip}}
  worker_ips: [
    {%- for ip in worker_ips%}
      "{{ip}}",
    {%- endfor %}
  ]

auth:
  ssh_user: {{ssh_user}}
  ssh_private_key: {{ssh_private_key}}

# Format: `REMOTE_PATH : LOCAL_PATH`
file_mounts: {
  "{{sky_ray_yaml_remote_path}}": "{{sky_ray_yaml_local_path}}",
  "{{sky_remote_path}}": "{{sky_local_path}}",
{%- for remote_path, local_path in credentials.items() %}
  "{{remote_path}}": "{{local_path}}",
{%- endfor %}
}

rsync_exclude: [
{%- for exclude_file in credential_excludes %}
  "{{exclude_file}}",
{%- endfor %}
]

# List of shell commands to run to set up nodes.
# (Bug) This will run only on head...
setup_commands:
  - (type -a python | grep -q python3) || echo 'alias python=python3' >> ~/.bashrc;
    (type -a pip | grep -q pip3) || echo 'alias pip=pip3' >> ~/.bashrc;
  - pip3 install -U ray[default]=={{ray_version}} && mkdir -p ~/sky_workdir && mkdir -p ~/.sky/sky_app;
  - pip3 uninstall sky -y &> /dev/null; pip3 install {{sky_remote_path}}/*.whl 

head_setup_commands:
  - (ps aux | grep "-m sky.skylet.skylet" | grep -q python) || nohup python3 -m sky.skylet.skylet >> ~/.sky/skylet.log 2>&1 & # Start skylet daemon. (Should not place it in the head_setup_commands, otherwise it will run before sky is installed.)

head_start_ray_commands: []

worker_start_ray_commands: []
