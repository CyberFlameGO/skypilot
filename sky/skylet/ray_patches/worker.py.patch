0a1,4
> # Adapted from https://github.com/ray-project/ray/blob/ray-2.6.1/python/ray/_private/worker.py
> # Fixed the problem in ray's issue https://github.com/ray-project/ray/issues/9233
> # Tracked in PR https://github.com/ray-project/ray/pull/21977/files.
> 
1892a1897,1904
>     
>     def end_for(line: str) -> str:
>         if sys.platform == "win32":
>             return "\n"
>         if line.startswith("\r") and not line[1:].strip().startswith("100%"):
>             return ""
>         return "\n"
> 
1916a1929
>                     end=end_for(line),
1934a1948
>                     end=end_for(line),
