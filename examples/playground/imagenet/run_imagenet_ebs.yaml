resources:
  cloud: aws
  accelerators: V100

file_mounts:
  /imagenet:
    name: sky-imagenet-data
    mode: MOUNT

setup: |
  git clone https://github.com/Michaelvll/examples.git
  cd ./examples/imagenet
  conda create -n imagenet python=3.9 -y
  conda activate imagenet
  conda install pytorch torchvision torchaudio cudatoolkit=11.3 -c pytorch -y
  pip install -r requirements.txt
  pip install wandb
  wandb login <your-wandb-token>

run: |
  if [ ! -d ~/imagenet ]; then
    unzip /imagenet/imagenet2012.zip -d ~
  fi

  conda activate imagenet
  mkdir -p /imagenet/checkpoints/ILSRC2012/imagenet/resnet50-ebs
  
  python main.py -a resnet50 \
    --save-path /imagenet/checkpoints/ILSRC2012/imagenet/resnet50-ebs \
    --resume /imagenet/checkpoints/ILSRC2012/imagenet/resnet50-ebs \
    ~/imagenet

